<html>
<head>
<link rel="stylesheet" href="css/style.css">
<script type="text/javascript" src="js/user.js"></script>
<script type="text/javascript" src="js/cookie.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript"> document.addEventListener('DOMContentLoaded', function(){ getCookie();}, {once: true});</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="js/w3.js"></script>
<script> user = getUser();
	 recipientList = getRecipientsByUser(); 
	 contractList = getContractsByUser();
	 reviewList = getReviewsByCaregiver();
</script>

<style>
ul {
  list-style-type: none;
}
</style>

</head>
<body>

<div class="topnav">
  <button class="navbutton" onclick="location.href='profile.html'">Profile</button>
  <button class="navbutton" onclick="location.href='search.html'">Search</button>
  <button class="navbutton" onclick="location.href='contract.html'">Contract</button>
</div>
<h1>Profile</h1>
  <div class=row>
    <div class=lcol>
      Name:<br>
      User ID:<br>
      Address:<br>
      Email:<br>
      Phone Number:<br>
      Current Balance:<br>
      Remaining Hours:<br>
      Registration Date:<br>
      Previous Login:<br>
    </div>
    <div class=rcol>
      <div id="name">
        {{firstName}} {{lastName}} <br>
        {{userID}}
      </div>
      <div id="address">
      	{{address}}
      </div>
      <div id="contact">
      	{{email}} <br>
        {{phone}}
      </div>
      <div id="account">
      	{{balance}} <br>
        {{availableHours}} <br>
        {{dateCreated}} <br>
        {{lastLogin}}
      </div>
    </div>
  </div>


  <script>
    w3.displayObject("name", user);
    w3.displayObject("address", user);
    w3.displayObject("contact", user);
    w3.displayObject("account", user);
  </script>

  <h2>Your Care Recipients</h2>
  <ul id="recipientlist">
    <li w3-repeat="recipients"><br>Recipient#{{userID}}<br>
	{{firstName}} {{lastName}}<br>
	{{address}}<br>
	Age: {{age}}<br>
	{{notes}}</li>
  </ul>
  <script>
    w3.displayObject("recipientlist", recipientList); 
  </script>
  <br>
  <button class="navbutton" onclick="location.href='addrecipient.html'">Add Recipient</button>
  <br>
  <br>
  <h2>Your Active Contracts</u2>
  <ul id="contractlist">
    <li w3-repeat="contracts"><a id="myLink" href="#" onclick="viewContract({{contractID}});return false;"> <br>Contract#{{contractID}}</a><br>
	Caregiver ID: {{caregiverID}}<br>
	Recipient ID: {{recipientID}}<br>
	{{startDate}} to {{endDate}}<br>
	Approved?: {{approved}}</li>
  </ul>
  <script>
    w3.displayObject("contractlist", contractList);
  </script>
  <p id="rating"></p>
	<ul id="reviewlist">
    		<li w3-repeat="reviews"><br>
			Review#{{contractID}}</a><br>
			Contract ID: {{contractID}}<br>
			Reviewer ID: {{reviewerID}}<br>
			Rating: {{rating}}<br>
			Notes: {{notes}}
			</li>
  	</ul>
	
  <script>
    w3.displayObject("reviewlist", reviewList);

    let rating = document.getElementById("rating");   
    let sum = 0;
    for (i = 0; i < reviewList.reviews.length; i++) {
      sum += reviewList.reviews[i].rating;
    }
    if (reviewList.reviews.length > 0) {
        reviewAvg = sum / reviewList.reviews.length;
    }
    else {
        reviewAvg = 0;
    }
    rating.innerHTML = "<b>Your Rating: </b>" + reviewAvg;
    
    function viewContract(ID){
      console.log(ID);
      contractID = ID;
      window.location.href = "viewcontract.html";
    }
  </script>
  
  <br>
</body>
</html>

